<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">

<ui:composition template="/template/template.xhtml">
	<ui:define name="subtitle">Dashboard</ui:define>
	<ui:define name="main_content">
		<!-- Begin Page Content -->
		<div class="container">
			<!-- Content Row -->
			<div class="row">
			
				<!-- #{jobPipelineBean.jobPipelineInterviewByYear} -->
				<div class="col-xl-6 col-lg-6">
					<div class="card shadow mb-4">
						<!-- Card Header - Dropdown -->
						<div
							class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
							<h6 class="m-0 font-weight-bold text-primary">Recent Hires</h6>
							
						</div>
						<!-- Card Body -->
						<div class="card-body">
							<div class="row">
								<div class="table-responsive">
							<h:dataTable styleClass=" table"
								value="#{jobPipelineBean.jobPipelineRecentHireList}" var="j" >
								<h:column>
									<f:facet name="header">Name </f:facet>
									<h:link value="#{j.candidate.name }"  outcome="/views/detail_candidate">
											<f:param name="candidateid" value="#{j.candidate.id}"></f:param>
									</h:link>
								</h:column>
								<h:column>
									<f:facet name="header">Company</f:facet>
									<h:link value="#{ j.joborder.company.name }" outcome="/views/detail_company">
											<f:param name="companyid" value="#{j.joborder.company.id}"></f:param>
									</h:link>
									
								</h:column>
								<h:column>
									<f:facet name="header">Recruiter</f:facet>
									#{j.modifyBy.name}
									
								</h:column>
								<h:column>
									<f:facet name="header">Date</f:facet>
									#{ j.modify_date.toLocalDate() }
								</h:column>
								
								
								
							</h:dataTable>

						</div>
							</div>
						</div>
					</div>
				</div>

				<div class="col-xl-6 col-lg-6">
					<div class="card shadow mb-4">
						<div
							class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
							<h6 class="m-0 font-weight-bold text-primary">Hiring Overview</h6>
							
						</div>
						<div class="card-body">
							<div class="row">
								<!-- <canvas id="bar-chart" width="500" height="250"></canvas> -->

								<div class="col-12" id="tabs">
									<!-- Nav tabs -->
									<ul class="nav nav-tabs" role="tablist"> 
										<li class="nav-item"><a class="nav-link active" href="#yearly" aria-controls="yearly" role="tab" data-toggle="tab">Yearly</a>
										</li>
										<li class="nav-item"><a class="nav-link" href="#monthly" aria-controls="monthly" role="tab" data-toggle="tab">Monthly</a>
										</li>
										<li class="nav-item"><a class="nav-link" href="#weekly" aria-controls="weekly" role="tab" data-toggle="tab">Weekly</a>
										</li>
									</ul>

									<!-- Tab panes -->
									<div class="tab-content">
										<div role="tabpanel" class="tab-pane active" id="yearly">
											<div class="row">
												<div class="col-md-12">
													<div id="chart1" style="height: 200px;"></div>
												</div>
											</div>
										</div>
										<div role="tabpanel" class="tab-pane" id="monthly">
											<div class="row">
												<div class="col-md-12">
													<div id="chart2" style="height: 200px;"></div>
												</div>
											</div>
										</div>
										<div role="tabpanel" class="tab-pane" id="weekly">
											<div class="row">
												<div class="col-md-12">
													<div id="chart3" style="height: 200px;"></div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="container">
								<div class="row  mt-1">
									<div class="col-5 mx-auto" style="font-size: 13px;">
										<span class="interviews ml-3"></span><span class="ml-2" >Interviews</span>
										<span class="hires ml-2"></span><span class="ml-2">Hires</span>
									</div>
								</div>
								</div>





							</div>
						</div>
					</div>
					
				</div>
				
				<div class="col-xl-12 col-lg-12 ">
				<div class="card shadow mb-4">
					<!-- Card Header - Dropdown -->
					<div
						class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
						<h6 class="m-0 font-weight-bold text-primary">Important Candidates(Interview Request, Interviewing and Offered in Active Job Orders)</h6>

					</div>
					<!-- Card Body -->
					<div class="card-body">
						<div class="row">
							<div class="container ">
								<div class="row pt-3">
									<div class="table-responsive">
										<h:dataTable styleClass=" table table-striped table-bordered table-datatable"
											value="#{jobPipelineBean.jobPipelinePrcessActiveJobOrderList}" var="j" >
											<h:column>
												<f:facet name="header">Name </f:facet>
													<h:link value="#{j.candidate.name }"  outcome="/views/detail_candidate">
														<f:param name="candidateid" value="#{j.candidate.id}"></f:param>
													</h:link>
												
											</h:column>
											<h:column>
												<f:facet name="header">Status</f:facet>
												#{j.candidatejoborderstatus.short_description }

											</h:column>
											
											<h:column>
												<f:facet name="header">Position</f:facet>
												<h:link value="#{ j.joborder.job_position }"
													outcome="/views/detail_joborder">
													<f:param name="joborderid" value="#{j.joborder.id}"></f:param>
												</h:link>
											</h:column>
											
											<h:column>
												<f:facet name="header">Company</f:facet>
												<h:link value="#{ j.joborder.company.name }" outcome="/views/detail_company">
														<f:param name="companyid" value="#{j.joborder.company.id}"></f:param>
												</h:link>
												
											</h:column>
											

											<h:column>
												<f:facet name="header">Modified</f:facet>
												#{ j.modify_date.toLocalDate() }
											</h:column>
											
										</h:dataTable>

									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			</div>
			
			<!-- </ui:fragment> -->
			





		</div>

	</ui:define>
	
	
	
	<ui:define name="custom_js">
		<h:outputScript>
		
		function parseSVG(s) {
	        var div= document.createElementNS('http://www.w3.org/1999/xhtml', 'div');
	        div.innerHTML= '<svg xmlns="http://www.w3.org/2000/svg">'+s+'</svg>';
	        var frag= document.createDocumentFragment();
	        while (div.firstChild.firstChild)
	            frag.appendChild(div.firstChild.firstChild);
	        return frag;
	    }

		var yearly = #{chartBean.yearlyMorrisJson}

		var monthly = #{chartBean.monthlyMorrisJson};
		
		var weekly = #{chartBean.weeklyMorrisJson}
		
		var yearlyArr = [];
		  yearlyArr[0] = yearly[0]['interview'];
		  yearlyArr[1] = yearly[0]['hire'];
		  yearlyArr[2] = yearly[1]['interview'];
		  yearlyArr[3] = yearly[1]['hire'];
		  yearlyArr[4] = yearly[2]['interview'];
		  yearlyArr[5] = yearly[2]['hire'];
		  yearlyArr[6] = yearly[3]['interview'];
		  yearlyArr[7] = yearly[3]['hire'];
		  
		  var monthlyArr = [];
		  monthlyArr[0] = monthly[0]['interview'];
		  monthlyArr[1] = monthly[0]['hire'];
		  monthlyArr[2] = monthly[1]['interview'];
		  monthlyArr[3] = monthly[1]['hire'];
		  monthlyArr[4] = monthly[2]['interview'];
		  monthlyArr[5] = monthly[2]['hire'];
		  monthlyArr[6] = monthly[3]['interview'];
		  monthlyArr[7] = monthly[3]['hire'];
		  
		  var weeklyArr = [];
		  weeklyArr[0] = weekly[0]['interview'];
		  weeklyArr[1] = weekly[0]['hire'];
		  weeklyArr[2] = weekly[1]['interview'];
		  weeklyArr[3] = weekly[1]['hire'];
		  weeklyArr[4] = weekly[2]['interview'];
		  weeklyArr[5] = weekly[2]['hire'];
		  weeklyArr[6] = weekly[3]['interview'];
		  weeklyArr[7] = weekly[3]['hire'];

			
			var yearlyBar = Morris.Bar({
				  element: 'chart1',
				  data: yearly,
				  xkey: 'y',
				  ykeys: ['interview', 'hire'],
				  labels: ['Interviews', 'Hires'],
				  hideHover: 'auto',
				 yLabelFormat: function(y){return y != Math.round(y)?'':y;},
				  resize: true
				});

				var monthlyBar = Morris.Bar({
				  element: 'chart2',
				  data: monthly,
				  xkey: 'm',
				  ykeys: ['interview', 'hire'],
				  labels: ['Interviews', 'Hires'],
				  hideHover: 'auto',
				  yLabelFormat: function(m){return m != Math.round(m)?'':m;},
				  resize: true
				});
				
				var weeklyBar = Morris.Bar({
				  element: 'chart3',
				  data: weekly,
				  xkey: 'd',
				  ykeys: ['interview', 'hire'],
				  labels: ['Interviews', 'Hires'],
				  hideHover: 'auto',
				  gridTextSize: 10,
				 yLabelFormat: function(y){return y != Math.round(y)?'':y;},
				  resize: true
				});

				$('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
				  var target = $(e.target).attr("href") 

				  switch (target) {
				    case "#yearly":
				      yearlyBar.redraw();
				      yearlybar();
				      break;
				    case "#monthly":
				      monthlyBar.redraw();
				      monthlybar();
				      break;
				    case "#weekly":
				      weeklyBar.redraw();
				      weeklybar();
				      break;
				      
				  }
				});
				
				yearlybar();
				
				function monthlybar(){
						var items = $("#chart2").find( "svg" ).find("rect");
						$.each(items,function(index,v){
							if(index % 2 == 0)
								var value = monthlyArr[index];
							else
								var value = monthlyArr[index];
						    
						    var newY = parseFloat( $(this).attr('y') - 20 );
						    var halfWidth = parseFloat( $(this).attr('width') / 2 );
						    var newX = parseFloat( $(this).attr('x') ) +  halfWidth;
						    var output = '<text style="text-anchor: middle; font: 12px sans-serif;" x="'+newX+'" y="'+newY+'" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" font-size="12px" font-family="sans-serif" font-weight="normal" transform="matrix(1,0,0,1,0,6.875)"><tspan dy="3.75">'+value+'</tspan></text>';
						    $("#chart2").find( "svg" ).append(parseSVG(output));
						});

			}


			function yearlybar(){
				var items = $("#chart1").find( "svg" ).find("rect");
				
				$.each(items,function(index,v){
					/* alert(items); */
					if(index % 2 == 0)
						var value = yearlyArr[index];
						else
						var value = yearlyArr[index];
					
				    
				    var newY = parseFloat( $(this).attr('y') - 20 );
				    var halfWidth = parseFloat( $(this).attr('width') / 2 );
				    var newX = parseFloat( $(this).attr('x') ) +  halfWidth;
				    var output = '<text style="text-anchor: middle; font: 12px sans-serif;" x="'+newX+'" y="'+newY+'" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" font-size="12px" font-family="sans-serif" font-weight="normal" transform="matrix(1,0,0,1,0,6.875)"><tspan dy="3.75">'+value+'</tspan></text>';
				    $("#chart1").find( "svg" ).append(parseSVG(output));
				});
	 		
			}
			
			function weeklybar(){
						var items = $("#chart3").find( "svg" ).find("rect");
						$.each(items,function(index,v){
							if(index % 2 == 0)
								var value = weeklyArr[index];
							else
								var value = weeklyArr[index];
						    
						    var newY = parseFloat( $(this).attr('y') - 20 );
						    var halfWidth = parseFloat( $(this).attr('width') / 2 );
						    var newX = parseFloat( $(this).attr('x') ) +  halfWidth;
						    var output = '<text style="text-anchor: middle; font: 12px sans-serif;" x="'+newX+'" y="'+newY+'" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#000000" font-size="12px" font-family="sans-serif" font-weight="normal" transform="matrix(1,0,0,1,0,6.875)"><tspan dy="3.75">'+value+'</tspan></text>';
						    $("#chart3").find( "svg" ).append(parseSVG(output));
						});

			}
 		

		
		
 	</h:outputScript>
	</ui:define>
</ui:composition>
</html>
